var aria=aria||{},cachedCreateElement=Document.prototype.createElement;Document.prototype.createElement=function(e,t){for(var i=e.match(/(^|[\.\#])[^\.\#]*/g),s=cachedCreateElement.call(this,i[0]),o=0,r=i.length;o<r;o++){var n=i[o];"#"===n[0]?s.id=n.slice(1):"."===n[0]&&s.classList.add(n.slice(1))}for(var a in t)switch(a){case"attributes":for(var d in t[a])s.setAttribute(d,t[a][d]);break;case"dataset":case"style":for(var h in t[a])s[a][h]=t[a][h];break;default:s[a]=t[a]}return s},function(){aria.KeyCode={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},aria.Utils=aria.Utils||{},aria.Utils.matches=function(s,e){return Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=s.parentNode.querySelectorAll(e),i=t.length;0<=--i&&t.item(i)!==this;);return-1<i}),s.matches(e)},aria.Utils.remove=function(e){return e.remove&&"function"==typeof e.remove?e.remove():!(!e.parentNode||!e.parentNode.removeChild||"function"!=typeof e.parentNode.removeChild)&&e.parentNode.removeChild(e)},aria.Utils.isFocusable=function(e){if(0<e.tabIndex||0===e.tabIndex&&null!==e.getAttribute("tabIndex"))return!0;if(e.disabled)return!1;switch(e.nodeName){case"A":return!!e.href&&"ignore"!=e.rel;case"INPUT":return"hidden"!=e.type&&"file"!=e.type;case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},aria.Utils.getAncestorBySelector=function(e,t){if(!aria.Utils.matches(e,t+" "+e.tagName))return null;for(var i=e,s=null;null===s;)aria.Utils.matches(i.parentNode,t)?s=i.parentNode:i=i.parentNode;return s},aria.Utils.hasClass=function(e,t){return new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)},aria.Utils.insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},aria.Utils.addClass=function(e,t){aria.Utils.hasClass(e,t)||e.classList.add.apply(e.classList,t.split(" "))},aria.Utils.stopScroll=function(){var e=document.body,t=e.querySelector("header.navbar"),i=e.querySelector("nav.navbar-links"),s=t.offsetWidth,o=e.clientWidth;e.style.overflow="hidden",e.style.marginRight=e.clientWidth-o+"px",t.style.width=i.style.width=s+"px"},aria.Utils.enableScroll=function(){var e=document.body,t=e.querySelector("header.navbar"),i=e.querySelector("nav.navbar-links"),s=e.clientWidth;e.style.marginRight=s-e.clientWidth+"px",e.style.overflow="auto",e.style.overflowX="hidden",t.style.width=i.style.width=""},aria.Utils.IgnoreUtilFocusChanges=!1,aria.Utils.focusFirstDescendant=function(e,t){t=0;for(var i=e.childNodes.length;t<i;t++){var s=e.childNodes[t];if(aria.Utils.attemptFocus(s)||aria.Utils.focusFirstDescendant(s))return!0}return!1},aria.Utils.focusLastDescendant=function(e){for(var t=e.childNodes.length-1;0<=t;t--){var i=e.childNodes[t];if(aria.Utils.attemptFocus(i)||aria.Utils.focusLastDescendant(i))return!0}return!1},aria.Utils.attemptFocus=function(e){if(!aria.Utils.isFocusable(e))return!1;aria.Utils.IgnoreUtilFocusChanges=!0;var t=e.hasChildNodes()&&e.querySelector('[tabindex="-1"]');try{t?t.focus():e.focus()}catch(e){}return aria.Utils.IgnoreUtilFocusChanges=!1,document.activeElement===t?t:e};var t=aria.Utils.insertAfter;aria.OpenDialogList=aria.OpenDialogList||new Array(0),aria.getCurrentDialog=function(){if(aria.OpenDialogList&&aria.OpenDialogList.length)return aria.OpenDialogList[aria.OpenDialogList.length-1]},aria.closeCurrentDialog=function(){var e=aria.getCurrentDialog();return!!e&&(e.close(),!0)},aria.handleEscape=function(e){(e.which||e.keyCode)===aria.KeyCode.ESC&&aria.closeCurrentDialog()&&e.stopPropagation()},document.addEventListener("keyup",aria.handleEscape),aria.Dialog=function(e,t,i){if(this.dialogNode=document.getElementById(e),null===this.dialogNode||"dialog"!==this.dialogNode.getAttribute("role"))throw new Error("Dialog() requires a DOM element with ARIA role of dialog.");if("string"==typeof t)this.focusAfterClosed=document.getElementById(t);else{if("object"!=typeof t)throw new Error("the focusAfterClosed parameter is required for the aria.Dialog constructor.");this.focusAfterClosed=t}this.focusFirst="string"==typeof i?document.getElementById(i):"object"==typeof i?i:null;var s=document.createElement("div");this.preNode=this.dialogNode.parentNode.insertBefore(s,this.dialogNode),this.preNode.tabIndex=0;var o=document.createElement("div");this.postNode=this.dialogNode.parentNode.insertBefore(o,this.dialogNode.nextSibling),(this.postNode.tabIndex=0)<aria.OpenDialogList.length&&aria.getCurrentDialog().removeListeners(),this.addListeners(),aria.OpenDialogList.push(this),this.clearDialog(),this.dialogNode.className="default_dialog",document.getElementById("dialog_layer").className="showing",aria.Utils.stopScroll(),this.focusFirst?this.focusFirst.focus():aria.Utils.focusFirstDescendant(this.dialogNode),this.lastFocus=document.activeElement},aria.Dialog.prototype.clearDialog=function(){Array.prototype.map.call(this.dialogNode.querySelectorAll("input"),function(e){e.value=""})},aria.Dialog.prototype.close=function(){(aria.OpenDialogList.pop(),this.removeListeners(),aria.Utils.remove(this.preNode),aria.Utils.remove(this.postNode),this.dialogNode.className="hidden",this.focusAfterClosed.focus(),0<aria.OpenDialogList.length)?aria.getCurrentDialog().addListeners():(document.getElementById("dialog_layer").className="hidden",aria.Utils.enableScroll())},aria.Dialog.prototype.replace=function(e,t,i){aria.getCurrentDialog();aria.OpenDialogList.pop(),this.removeListeners(),aria.Utils.remove(this.preNode),aria.Utils.remove(this.postNode),this.dialogNode.className="hidden";var s=t||this.focusAfterClosed;new aria.Dialog(e,s,i)},aria.Dialog.prototype.addListeners=function(){document.addEventListener("focus",this.trapFocus,!0)},aria.Dialog.prototype.removeListeners=function(){document.removeEventListener("focus",this.trapFocus,!0)},aria.Dialog.prototype.trapFocus=function(e){if(!aria.Utils.IgnoreUtilFocusChanges){var t=aria.getCurrentDialog();t.dialogNode.contains(e.target)?t.lastFocus=e.target:(aria.Utils.focusFirstDescendant(t.dialogNode),t.lastFocus==document.activeElement&&aria.Utils.focusLastDescendant(t.dialogNode),t.lastFocus=document.activeElement)}},window.openDialog=function(e,t,i){if("object"==typeof t){var s=t.querySelector('[tabindex="-1"]');s&&(t=s)}new aria.Dialog(e,t,i)},window.closeDialog=function(e){var t=aria.getCurrentDialog();t.dialogNode.contains(e)&&t.close()},window.replaceDialog=function(e,t,i){var s=aria.getCurrentDialog();s.dialogNode.contains(document.activeElement)&&s.replace(e,t,i)},aria.datepicker=function(e,t){this.domNode=e,this.keys=Object.freeze(aria.KeyCode),this.options={selector:t&&t.selector||".datepicker-field",triggerLabel:t&&t.triggerLabel||"Select date",triggerIconClass:t&&t.triggerIconClass||"fa fa-calendar",nextMonthLabel:t&&t.nextMonthLabel||"next month",prevMonthLabel:t&&t.prevMonthLabel||"previous month",monthNames:t&&t.monthNames||["January","February","March","April","May","June","July","August","September","October","November","December"],dayNames:t&&t.dayNames||["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDayNames:t&&t.shortDayNames||["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dateFormat:t&&t.dateFormat||"D MMM YYYY"},this.init()},aria.datepicker.prototype.init=function(e){this.id=this.domNode.id,this.$trigger=null,this.$picker=null,this.createTrigger(),t(this.$trigger,this.domNode),this.createPicker(),t(this.$picker,this.$trigger),this.dateObj=e||new Date,this.curYear=this.dateObj.getFullYear(),this.year=this.curYear,this.curMonth=this.dateObj.getMonth(),this.month=this.curMonth,this.currentDate=!0,this.date=this.dateObj.getDate(),this.$monthObj.innerHTML=this.options.monthNames[this.month]+" "+this.year,this.popGrid(),this.$grid.setAttribute("aria-activedescendant",this.$grid.querySelector(".today").getAttribute("id")),this.addEvents(),this.domNode.datepicker=this},aria.datepicker.prototype.destroy=function(){aria.Utils.remove(this.$trigger),aria.Utils.remove(this.$picker)},aria.datepicker.prototype.createTrigger=function(){var e=document.createElement("i",{attributes:{class:this.options.triggerIconClass,"aria-hidden":!0}});this.$trigger=document.createElement("button",{id:"btn_"+this.id,attributes:{"aria-label":this.options.triggerLabel,class:"picker-trigger"}}),this.$trigger.appendChild(e)},aria.datepicker.prototype.createPicker=function(){var e,t,i;this.$picker=document.createElement("div",{id:"dp_"+this.id,attributes:{"aria-hidden":!0,class:"datepicker"}}),e=document.createElement("div.month-wrap"),t=document.createElement("div",{id:"btn_prev-label-"+this.id,attributes:{class:"offscreen"},textContent:this.options.prevMonthLabel}),i=document.createElement("div",{id:"btn_next-label-"+this.id,attributes:{class:"offscreen"},textContent:this.options.nextMonthLabel}),this.$prev=document.createElement("div",{attributes:{class:"btn_prev",role:"button","aria-labelledby":"btn_prev-label_"+this.id,tabindex:0}});var s=document.createElement("div",{attributes:{tabindex:-1}}),o=document.createElement("i",{attributes:{class:"fa fa-chevron-left","aria-hidden":!0}});this.$prev.appendChild(s),s.appendChild(o),this.$next=document.createElement("div",{attributes:{class:"btn_next",role:"button","aria-labelledby":"btn_next-label_"+this.id,tabindex:0}});var r=document.createElement("div",{attributes:{tabindex:-1}}),n=document.createElement("i",{attributes:{class:"fa fa-chevron-right","aria-hidden":!0}});this.$next.appendChild(r),r.appendChild(n),this.$monthObj=document.createElement("div",{attributes:{class:"month",role:"heading","aria-live":"assertive","aria-atomic":!0}}),e.appendChild(this.$prev),e.appendChild(this.$monthObj),e.appendChild(this.$next),this.$grid=document.createElement("table",{attributes:{class:"cal",role:"grid",tabindex:0,cellspacing:1}});for(var a=document.createElement("thead"),d=document.createElement("tr.weekdays"),h=0;h<7;h++){var u=document.createElement("th",{attributes:{"aria-label":this.options.dayNames[h]},textContent:this.options.shortDayNames[h]});d.appendChild(u)}a.appendChild(d);var c=document.createElement("tbody");this.$grid.appendChild(a),this.$grid.appendChild(c),this.$picker.appendChild(e),this.$picker.appendChild(this.$grid),this.$picker.appendChild(t),this.$picker.appendChild(i)},aria.datepicker.prototype.addEvents=function(){this.$trigger.addEventListener("click",this),this.$grid.addEventListener("click",this),this.$grid.addEventListener("keydown",this),this.$grid.addEventListener("keypress",this),this.$grid.addEventListener("focus",this),this.$grid.addEventListener("blur",this),this.$prev.addEventListener("click",this),this.$prev.addEventListener("keydown",this),this.$prev.addEventListener("blur",this),this.$next.addEventListener("click",this),this.$next.addEventListener("keydown",this),this.$next.addEventListener("blur",this),this.domNode.addEventListener("click",this,!0),this.domNode.addEventListener("change",this),this.domNode.addEventListener("focus",this),this.domNode.addEventListener("keydown",this),this.domNode.addEventListener("mousedown",this),this.domNode.addEventListener("select",this),document.addEventListener("blur",this)},aria.datepicker.prototype.removeEvents=function(){this.$trigger.removeEventListener("click",this)},aria.datepicker.prototype.handleEvent=function(e){switch(e.type){case"mousedown":return e.preventDefault(),!1;case"click":if((t=e.currentTarget)===this.$trigger)return e.stopPropagation(),e.preventDefault(),this.handleTriggerClick(e);if(t===this.$grid){if(e.target.matches("td"))return this.handleGridClick(e.target,e)}else{if(t===this.$picker)return this.handleInputClick(e);if(t===this.$prev)return this.handlePrevClick(e);if(t===this.$next)return this.handleNextClick(e);if(t===this.domNode)return t.focus(),this.handleInputClick(e)}break;case"keydown":if((t=e.currentTarget)===this.$grid)return this.handleGridKeyDown(e);if(t===this.$prev)return this.handlePrevKeyDown(e);if(t===this.$next)return this.handleNextKeyDown(e);if(t===this.domNode)return this.handleInputKeyDown(e);break;case"keypress":if((t=e.currentTarget)===this.$grid)return this.handleGridKeyPress(e);break;case"focus":if((t=e.currentTarget)===this.$grid)return this.handleGridFocus(e);if(t===this.domNode)return this.handleInputFocus(e);break;case"blur":var t=e.currentTarget;setTimeout(function(){if(!this.$picker.contains(t)||t===document||!this.$picker.contains(document.activeElement))return this.handleGridBlur(e)}.bind(this),100)}},aria.datepicker.prototype.handleTriggerClick=function(e){return e.stopPropagation(),e.preventDefault(),this.hideOthers(),this.toggleDlg(),!1},aria.datepicker.prototype.handleGridClick=function(e,t){var i=e;if(i.classList.contains(".empty")||"true"===i.getAttribute("aria-hidden"))return!0;var s=this.$grid.querySelector(".focus");s&&(s.classList.remove("focus"),s.setAttribute("aria-selected",!1)),i.classList.add("focus"),i.setAttribute("aria-selected","true"),this.$grid.setAttribute("aria-activedescendant",i.getAttribute("id"));var o=this.$grid.querySelector("#"+this.$grid.getAttribute("aria-activedescendant"));this.domNode.value=moment(o.textContent+"/"+(this.month+1)+"/"+this.year,"D/M/YYYY").format(this.options.dateFormat);var r=document.createEvent("Event");return r.initEvent("change",!1,!0),this.domNode.dispatchEvent(r),this.hideDlg(),t.stopPropagation(),!1},aria.datepicker.prototype.handleInputClick=function(e){return document.activeElement===this.domNode&&this.toggleDlg(),!1},aria.datepicker.prototype.handlePrevClick=function(e){var t=this.$grid.getAttribute("aria-activedescendant");return e.ctrlKey?this.showPrevYear():this.showPrevMonth(),0==this.currentDate?this.$grid.setAttribute("aria-activedescendant",this.id+"_day1"):this.$grid.setAttribute("aria-activedescendant",t),e.stopPropagation(),!1},aria.datepicker.prototype.handleNextClick=function(e){var t=this.$grid.getAttribute("aria-activedescendant");return e.ctrlKey?this.showNextYear():this.showNextMonth(),0==this.currentDate?this.$grid.setAttribute("aria-activedescendant",this.id+"_day1"):this.$grid.setAttribute("aria-activedescendant",t),e.stopPropagation(),!1},aria.datepicker.prototype.handleGridKeyDown=function(e){this.$grid.querySelectorAll("tbody tr");var t=this.$grid.querySelector("#"+this.$grid.getAttribute("aria-activedescendant")),i=[].slice.call(this.$grid.querySelectorAll("td")).filter(function(e){return!e.classList.contains("empty")});t.parentNode;if(e.altKey)return!0;switch(e.keyCode){case this.keys.TAB:return e.stopPropagation(),e.preventDefault(),e.shiftKey?this.$next.focus():this.$prev.focus(),!1;case this.keys.RETURN:case this.keys.SPACE:if(e.ctrlKey)return!0;if(this.domNode){this.domNode.value=moment(t.textContent+"/"+(this.month+1)+"/"+this.year,"D/M/YYYY").format(this.options.dateFormat);var s=document.createEvent("Event");s.initEvent("change",!1,!0),this.domNode.dispatchEvent(s)}case this.keys.ESC:return this.hideDlg(),e.stopPropagation(),e.preventDefault(),!1;case this.keys.LEFT:if(e.ctrlKey||e.shiftKey)return!0;var o=null;return 0<=(n=i.indexOf(t)-1)?"true"!==(o=i[n]).getAttribute("aria-hidden")&&(t.classList.remove("focus"),t.setAttribute("aria-selected","false"),o.classList.add("focus"),o.setAttribute("aria-selected","true"),this.$grid.setAttribute("aria-activedescendant",o.getAttribute("id"))):this.showPrevMonth(0),e.stopPropagation(),!1;case this.keys.RIGHT:if(e.ctrlKey||e.shiftKey)return!0;var r=null;return(n=i.indexOf(t)+1)<i.length?("true"===(r=i[n]).getAttribute("aria-hidden")&&(r=this.$grid.querySelector('[aria-hidden="false"]')),t.classList.remove("focus"),t.setAttribute("aria-selected","false"),r.classList.add("focus"),r.setAttribute("aria-selected","true"),this.$grid.setAttribute("aria-activedescendant",r.getAttribute("id"))):this.showNextMonth(1),e.stopPropagation(),!1;case this.keys.UP:if(e.ctrlKey||e.shiftKey)return!0;o=null;return 0<=(n=i.indexOf(t)-7)?"true"!==(o=i[n]).getAttribute("aria-hidden")&&(t.classList.remove("focus"),t.setAttribute("aria-selected","false"),o.classList.add("focus"),o.setAttribute("aria-selected","true"),this.$grid.setAttribute("aria-activedescendant",o.getAttribute("id"))):(n=6-i.indexOf(t),this.showPrevMonth(n)),e.stopPropagation(),!1;case this.keys.DOWN:if(e.ctrlKey||e.shiftKey)return!0;var n;o=null;return(n=i.indexOf(t)+7)<i.length?(o=i[n],t.classList.remove("focus"),t.setAttribute("aria-selected","false"),o.classList.add("focus"),o.setAttribute("aria-selected","true"),this.$grid.setAttribute("aria-activedescendant",o.getAttribute("id"))):(n=8-(i.length-i.indexOf(t)),this.showNextMonth(n)),e.stopPropagation(),!1;case this.keys.PAGE_UP:var a=this.$grid.getAttribute("aria-activedescendant");if(e.shiftKey)return!0;if(e.ctrlKey?this.showPrevYear():this.showPrevMonth(),void 0===this.$grid.querySelector("#"+a).getAttribute("id")){var d=this.id+"_day"+this.calcNumDays(this.year,this.month),h=this.$grid.querySelector("#"+d);h.classList.add("focus"),h.setAttribute("aria-selected","true")}else{"true"===(u=this.$grid.querySelector("#"+a)).getAttribute("aria-hidden")&&(u=this.$grid.querySelector('[aria-hidden="false"]')),u.classList.add("focus"),u.setAttribute("aria-selected","true")}return e.stopPropagation(),!1;case this.keys.PAGE_DOWN:a=this.$grid.getAttribute("aria-activedescendant");if(e.shiftKey)return!0;if(e.ctrlKey?this.showNextYear():this.showNextMonth(),this.$grid.querySelector("#"+a)){(c=this.$grid.querySelector("#"+a)).classList.add("focus"),c.setAttribute("aria-selected","true")}else{var u;d=this.id+"_day"+this.calcNumDays(this.year,this.month);(u=this.$grid.querySelector("#"+d)).classList.add("focus"),u.setAttribute("aria-selected","true")}return e.stopPropagation(),!1;case this.keys.HOME:return!(!e.ctrlKey&&!e.shiftKey)||(t.classList.remove("focus"),t.setAttribute("aria-selected","false"),(c=this.$grid.querySelector('[aria-hidden="false"]')).classList.add("focus"),c.setAttribute("aria-selected","true"),this.$grid.setAttribute("aria-activedescendant",c.getAttribute("id")),e.stopPropagation(),!1);var c;case this.keys.END:if(e.ctrlKey||e.shiftKey)return!0;d=this.id+"_day"+this.calcNumDays(this.year,this.month);return t.classList.remove("focus"),t.setAttribute("aria-selected","false"),(h=this.$grid.querySelector("#"+d)).classList.add("focus"),h.setAttribute("aria-selected","true"),this.$grid.setAttribute("aria-activedescendant",d),e.stopPropagation(),!1}return!0},aria.datepicker.prototype.handleGridKeyPress=function(e){if(e.altKey)return!0;switch(e.keyCode){case this.keys.tab:case this.keys.enter:case this.keys.space:case this.keys.esc:case this.keys.left:case this.keys.right:case this.keys.up:case this.keys.down:case this.keys.pageup:case this.keys.pagedown:case this.keys.home:case this.keys.end:return e.stopPropagation(),!1}return!0},aria.datepicker.prototype.handleGridFocus=function(e){var t,i=this.$grid.getAttribute("aria-activedescendant");if(this.$grid.querySelector("#"+i))"true"===(t=this.$grid.querySelector("#"+i)).getAttribute("aria-hidden")&&(t=this.$grid.querySelector('[aria-hidden="false"]')),t.classList.add("focus"),t.setAttribute("aria-selected","true");else{var s=this.id+"_day"+this.calcNumDays(this.year,this.month);(t=this.$grid.querySelector("#"+s)).classList.add("focus"),t.setAttribute("aria-selected","true")}return!0},aria.datepicker.prototype.handleGridBlur=function(e){var t=this.$grid.querySelector("#"+this.$grid.getAttribute("aria-activedescendant"));return t.classList.remove("focus"),t.setAttribute("aria-selected","false"),setTimeout(function(e){this.$picker.contains(e.currentTarget)||this.hideDlg()}.bind(this,e),0),!0},aria.datepicker.prototype.handlePrevKeyDown=function(e){if(e.altKey)return!0;switch(e.keyCode){case this.keys.TAB:return!(e.shiftKey&&!e.ctrlKey)||(e.shiftKey?(this.$grid.focus(),e.preventDefault()):(this.$grid.focus(),e.stopPropagation()),!1);case this.keys.RETURN:case this.keys.SPACE:return!!e.shiftKey||(e.ctrlKey?this.showPrevYear():this.showPrevMonth(),e.stopPropagation(),!1);case this.keys.ESC:return this.hideDlg(),e.stopPropagation(),e.preventDefault(),!1}return!0},aria.datepicker.prototype.handleNextKeyDown=function(e){if(e.altKey)return!0;switch(e.keyCode){case this.keys.TAB:return!(e.shiftKey&&!e.ctrlKey)||(e.shiftKey?(this.$prev.focus(),e.preventDefault(),!0):(this.$grid.focus(),e.stopPropagation(),!1));case this.keys.RETURN:case this.keys.SPACE:return e.ctrlKey?this.showNextYear():this.showNextMonth(),e.stopPropagation(),!1;case this.keys.ESC:return this.hideDlg(),e.stopPropagation(),e.preventDefault(),!1}return!0},aria.datepicker.prototype.handleInputFocus=function(e){return"true"===this.$picker.getAttribute("aria-hidden")&&(this.hideOthers(),this.showDlg()),!1},aria.datepicker.prototype.handleInputKeyDown=function(e){switch(e.keyCode){case this.keys.TAB:if(!e.shiftKey||e.ctrlKey)return this.$trigger.setAttribute("tabindex",-1),setTimeout(function(){this.$trigger.removeAttribute("tabindex")}.bind(this),0),!0}},aria.datepicker.prototype.setDate=function(e,t){this.destroy(),this.init(e),this.domNode.value=t;var i=document.createEvent("Event");i.initEvent("change",!1,!0),this.domNode.dispatchEvent(i)},aria.datepicker.prototype.calcNumDays=function(e,t){return 32-new Date(e,t,32).getDate()},aria.datepicker.prototype.calcStartWeekday=function(e,t){return new Date(e,t,1).getDay()},aria.datepicker.prototype.showPrevMonth=function(e){if(0==this.month?(this.month=11,this.year--):this.month--,this.month!=this.curMonth||this.year!=this.curYear?this.currentDate=!1:this.currentDate=!0,this.popGrid(),this.$monthObj.innerHTML=this.options.monthNames[this.month]+" "+this.year,null!=e){var t=this.calcNumDays(this.year,this.month),i=this.id+"_day"+(t-e),s=this.$grid.querySelector("#"+i);this.$grid.setAttribute("aria-activedescendant",i),s.classList.add("focus"),s.setAttribute("aria-selected","true")}},aria.datepicker.prototype.showNextMonth=function(e){if(11==this.month?(this.month=0,this.year++):this.month++,this.month!=this.curMonth||this.year!=this.curYear?this.currentDate=!1:this.currentDate=!0,this.popGrid(),this.$monthObj.innerHTML=this.options.monthNames[this.month]+" "+this.year,null!=e){var t=this.id+"_day"+e,i=this.$grid.querySelector("#"+t);this.$grid.setAttribute("aria-activedescendant",t),i.classList.add("focus"),i.setAttribute("aria-selected","true")}},aria.datepicker.prototype.showPrevYear=function(){if(this.year<=this.dateObj.getFullYear())return!1;this.year--,this.month!=this.curMonth||this.year!=this.curYear?this.currentDate=!1:this.currentDate=!0,this.popGrid(),this.$monthObj.innerHTML=this.options.monthNames[this.month]+" "+this.year},aria.datepicker.prototype.showNextYear=function(){this.year++,this.month!=this.curMonth||this.year!=this.curYear?this.currentDate=!1:this.currentDate=!0,this.popGrid(),this.$monthObj.innerHTML=this.options.monthNames[this.month]+" "+this.year},aria.datepicker.prototype.popGrid=function(){var e=this.calcNumDays(this.year,this.month),t=this.calcStartWeekday(this.year,this.month),i=0,s=1,o=1,r=this.$grid.querySelector("tbody"),n=this.dateObj.getMonth()===this.month&&this.dateObj.getFullYear()===this.year,a='\t<tr id="row1">\n';for(this.$prev.style.visibility=n?"hidden":"",r.innerHTML="",i=0;i<t;i++)a+='\t\t<td class="empty" aria-hidden="true">&nbsp;</td>\n';for(s=1;s<=e;s++){var d=", "+this.options.monthNames[this.month]+" "+s+", "+this.year,h=this.year===this.dateObj.getFullYear()&&this.month===this.dateObj.getMonth()&&s<this.date;s===this.date&&!0===this.currentDate?a+='\t\t<td id="'+this.id+"_day"+s+'" class="today" headers="row'+o+" "+this.options.dayNames[i]+'" role="gridcell" aria-selected="false" tabindex="0" aria-label="'+d+'" aria-hidden="false">'+s+"</td>":a+='\t\t<td id="'+this.id+"_day"+s+'" headers="row'+o+" "+this.options.dayNames[i]+'" role="gridcell" aria-selected="false" aria-label="'+d+'" aria-hidden="'+h+'">'+s+"</td>",6==i&&s<e?(a+='\t</tr>\n\t<tr id="row'+ ++o+'">\n',i=0):i++}for(;i<7;i++)a+='\t\t<td class="empty" aria-hidden="true">&nbsp;</td>\n';a+="\t</tr>",r.innerHTML=a},aria.datepicker.prototype.showDlg=function(){document.addEventListener("click",this.consumeMouseEvents),document.addEventListener("mousedown",this.consumeMouseEvents),document.addEventListener("mouseup",this.consumeMouseEvents),document.addEventListener("mousemove",this.consumeMouseEvents),document.addEventListener("mouseover",this.consumeMouseEvents),aria.Utils.stopScroll(),this.$picker.setAttribute("aria-hidden","false"),this.$grid.focus()},aria.datepicker.prototype.consumeMouseEvents=function(e){return e.stopPropagation(),!1},aria.datepicker.prototype.hideDlg=function(e){"false"===this.$picker.getAttribute("aria-hidden")&&(e=e||!0,document.removeEventListener("click",this.consumeMouseEvents),document.removeEventListener("mousedown",this.consumeMouseEvents),document.removeEventListener("mouseup",this.consumeMouseEvents),document.removeEventListener("mousemove",this.consumeMouseEvents),document.removeEventListener("mouseover",this.consumeMouseEvents),aria.Utils.enableScroll(),e&&this.domNode&&this.domNode.focus(),this.$picker.setAttribute("aria-hidden","true"))},aria.datepicker.prototype.toggleDlg=function(){"true"===this.$picker.getAttribute("aria-hidden")?this.showDlg():this.hideDlg()},aria.datepicker.prototype.hideOthers=function(){for(var e=[].slice.call(document.querySelectorAll(this.options.selector)).filter(function(e){return e!==this.domNode}.bind(this)),t=0,i=e.length;t<i;t++)e[t].datepicker.hideDlg(!1)}}();var Accordion=function(e){this.domNode=e,this.hasFocus=!1,this.label=e.querySelector("span"),this.keyCode=Object.freeze(aria.KeyCode),this.init()};Accordion.prototype.init=function(){this.domNode.setAttribute("aria-expanded",!1),this.addEvents(),this.domNode.accordion=this;var e=document.getElementById(this.domNode.getAttribute("aria-controls"));e&&(this.panel=new AccordionPanel(e,this),this.panel.init())},Accordion.prototype.unload=function(){this.domNode.removeAttribute("aria-expanded"),this.domNode.removeAttribute("tabindex"),this.removeEvents(),this.panel.unload()},Accordion.prototype.handleEvent=function(e){switch(e.type){case"click":this.handleClick(e);break;case"keydown":this.handleKeydown(e)}},Accordion.prototype.addEvents=function(){this.domNode.addEventListener("keydown",this),this.domNode.addEventListener("click",this)},Accordion.prototype.removeEvents=function(){this.domNode.removeEventListener("keydown",this),this.domNode.removeEventListener("click",this)},Accordion.prototype.handleKeydown=function(e){e.currentTarget;var t=!1;switch(e.keyCode){case this.keyCode.SPACE:case this.keyCode.RETURN:this.panel&&(this.panel.opened?this.panel.close():this.panel.open()),t=!0}t&&(e.stopPropagation(),e.preventDefault())},Accordion.prototype.handleClick=function(e){"true"===this.domNode.getAttribute("aria-expanded")&&e.currentTarget===this.domNode?this.panel.close():this.panel.open()};var AccordionPanel=function(e,t){this.domNode=e,this.controller=t,this.hasFocus=!1,this.opened=!1};AccordionPanel.prototype.init=function(){this.domNode.setAttribute("aria-hidden",!0),this.domNode.style.display="none"},AccordionPanel.prototype.unload=function(){this.domNode.removeAttribute("aria-hidden"),this.domNode.style.display="block"},AccordionPanel.prototype.open=function(){this.controller.domNode.setAttribute("aria-expanded",!0),this.domNode.setAttribute("aria-hidden",!1),this.domNode.style.display="block",this.domNode.focus(),this.hasFocus=!0,this.opened=!0},AccordionPanel.prototype.close=function(){this.controller.domNode.setAttribute("aria-expanded",!1),this.domNode.setAttribute("aria-hidden",!0),this.domNode.style.display="none",this.controller.label.focus(),this.controller.hasFocus=!0,this.domNode.hasFocus=!1,this.opened=!1};var Menubutton=function(e){this.domNode=e,this.popupMenu=!1,this.hasFocus=!1,this.hasHover=!1,this.keyCode=Object.freeze(aria.KeyCode)};Menubutton.prototype.init=function(){this.domNode.setAttribute("aria-haspopup","true"),this.domNode.addEventListener("keydown",this.handleKeydown.bind(this)),this.domNode.addEventListener("click",this.handleClick.bind(this)),this.domNode.addEventListener("focus",this.handleFocus.bind(this)),this.domNode.addEventListener("blur",this.handleBlur.bind(this));var e=document.getElementById(this.domNode.getAttribute("aria-controls"));e&&(this.popupMenu=new PopupMenuLinks(e,this),this.popupMenu.init())},Menubutton.prototype.handleKeydown=function(e){e.currentTarget;var t=!1;switch(e.keyCode){case this.keyCode.SPACE:case this.keyCode.RETURN:this.popupMenu&&(this.popupMenu.open(),this.popupMenu.setFocusToFirstItem()),t=!0}t&&(e.stopPropagation(),e.preventDefault())},Menubutton.prototype.handleClick=function(e){"true"===this.domNode.getAttribute("aria-expanded")&&e.currentTarget===this.domNode?this.popupMenu.close(!0):(this.popupMenu.open(),this.popupMenu.setFocusToFirstItem())},Menubutton.prototype.handleFocus=function(e){this.popupMenu.hasFocus=!0},Menubutton.prototype.handleBlur=function(e){this.popupMenu.hasFocus=!1},Menubutton.prototype.handleMouseover=function(e){this.hasHover=!0,this.popupMenu.open()},Menubutton.prototype.handleMouseout=function(e){this.hasHover=!1,setTimeout(this.popupMenu.close.bind(this.popupMenu,!1),300)};var MenuItemLinks=function(e,t){this.domNode=e,this.menu=t,this.keyCode=Object.freeze(aria.KeyCode)};MenuItemLinks.prototype.init=function(){this.domNode.tabIndex=-1,this.domNode.getAttribute("role")||this.domNode.setAttribute("role","menuitem"),this.domNode.addEventListener("keydown",this.handleKeydown.bind(this)),this.domNode.addEventListener("click",this.handleClick.bind(this)),this.domNode.addEventListener("focus",this.handleFocus.bind(this)),this.domNode.addEventListener("blur",this.handleBlur.bind(this)),this.domNode.addEventListener("mouseover",this.handleMouseover.bind(this)),this.domNode.addEventListener("mouseout",this.handleMouseout.bind(this))},MenuItemLinks.prototype.handleKeydown=function(e){e.currentTarget;var t=!1,i=e.key;function s(e){return 1===e.length&&e.match(/\S/)}if(!(e.ctrlKey||e.altKey||e.metaKey||e.keyCode===this.keyCode.SPACE||e.keyCode===this.keyCode.RETURN)){if(e.shiftKey)s(i)&&this.menu.setFocusByFirstCharacter(this,i);else switch(e.keyCode){case this.keyCode.ESC:this.menu.setFocusToController(),this.menu.close(!0),t=!0;break;case this.keyCode.UP:this.menu.setFocusToPreviousItem(this),t=!0;break;case this.keyCode.DOWN:this.menu.setFocusToNextItem(this),t=!0;break;case this.keyCode.HOME:case this.keyCode.PAGEUP:this.menu.setFocusToFirstItem(),t=!0;break;case this.keyCode.END:case this.keyCode.PAGEDOWN:this.menu.setFocusToLastItem(),t=!0;break;case this.keyCode.TAB:this.menu.setFocusToController(),this.menu.close(!0);break;default:s(i)&&this.menu.setFocusByFirstCharacter(this,i)}t&&(e.stopPropagation(),e.preventDefault())}},MenuItemLinks.prototype.handleClick=function(e){this.domNode.getAttribute("aria-controls")||(this.menu.setFocusToController(),this.menu.close(!0))},MenuItemLinks.prototype.handleFocus=function(e){this.menu.hasFocus=!0},MenuItemLinks.prototype.handleBlur=function(e){this.menu.hasFocus=!1,setTimeout(this.menu.close.bind(this.menu,!1),300)},MenuItemLinks.prototype.handleMouseover=function(e){this.menu.hasHover=!0,this.menu.open()},MenuItemLinks.prototype.handleMouseout=function(e){this.menu.hasHover=!1,setTimeout(this.menu.close.bind(this.menu,!1),300)};var PopupMenuLinks=function(e,t){var i="PopupMenuLinks constructor argument domNode ";if(!e instanceof Element)throw new TypeError(i+"is not a DOM Element.");if(0===e.childElementCount)throw new Error(i+"has no element children.");for(var s=e.firstElementChild;s;){var o=s.firstElementChild;if(o&&"A"===o)throw new Error(i+"has descendant elements that are not A elements.");s=s.nextElementSibling}this.domNode=e,this.controller=t,this.menuitems=[],this.firstChars=[],this.firstItem=null,this.lastItem=null,this.hasFocus=!1,this.hasHover=!1};PopupMenuLinks.prototype.init=function(){var e,t,i,s,o,r;for(this.domNode.tabIndex=-1,this.domNode.setAttribute("role","menu"),this.domNode.getAttribute("aria-labelledby")||this.domNode.getAttribute("aria-label")||this.domNode.getAttribute("title")||(r=this.controller.domNode.innerHTML,this.domNode.setAttribute("aria-label",r)),this.domNode.addEventListener("mouseover",this.handleMouseover.bind(this)),this.domNode.addEventListener("mouseout",this.handleMouseout.bind(this)),e=this.domNode.firstElementChild;e;)(t=e.firstElementChild)&&"A"===t.tagName&&((i=new MenuItemLinks(t,this)).init(),this.menuitems.push(i),s=t.textContent.trim(),this.firstChars.push(s.substring(0,1).toLowerCase())),e=e.nextElementSibling;0<(o=this.menuitems.length)&&(this.firstItem=this.menuitems[0],this.lastItem=this.menuitems[o-1])},PopupMenuLinks.prototype.handleMouseover=function(e){this.hasHover=!0},PopupMenuLinks.prototype.handleMouseout=function(e){this.hasHover=!1,setTimeout(this.close.bind(this,!1),300)},PopupMenuLinks.prototype.setFocusToController=function(e){"string"!=typeof e&&(e=""),"previous"===e?this.controller.menubar.setFocusToPreviousItem(this.controller):"next"===e?this.controller.menubar.setFocusToNextItem(this.controller):this.controller.domNode.focus()},PopupMenuLinks.prototype.setFocusToFirstItem=function(){this.firstItem.domNode.focus()},PopupMenuLinks.prototype.setFocusToLastItem=function(){this.lastItem.domNode.focus()},PopupMenuLinks.prototype.setFocusToPreviousItem=function(e){var t;e===this.firstItem?this.lastItem.domNode.focus():(t=this.menuitems.indexOf(e),this.menuitems[t-1].domNode.focus())},PopupMenuLinks.prototype.setFocusToNextItem=function(e){var t;e===this.lastItem?this.firstItem.domNode.focus():(t=this.menuitems.indexOf(e),this.menuitems[t+1].domNode.focus())},PopupMenuLinks.prototype.setFocusByFirstCharacter=function(e,t){var i,s;t=t.toLowerCase();(i=this.menuitems.indexOf(e)+1)===this.menuitems.length&&(i=0),-1===(s=this.getIndexFirstChars(i,t))&&(s=this.getIndexFirstChars(0,t)),-1<s&&this.menuitems[s].domNode.focus()},PopupMenuLinks.prototype.getIndexFirstChars=function(e,t){for(var i=e;i<this.firstChars.length;i++)if(t===this.firstChars[i])return i;return-1},PopupMenuLinks.prototype.open=function(){var e=this.controller.domNode.getBoundingClientRect();this.domNode.style.display="block",this.domNode.style.position="absolute",this.domNode.style.top=e.height+"px",this.domNode.style.left="0px",this.controller.domNode.setAttribute("aria-expanded","true")},PopupMenuLinks.prototype.close=function(e){!e&&(this.hasFocus||this.hasHover||this.controller.hasHover)||(this.domNode.style.display="none",this.controller.domNode.removeAttribute("aria-expanded"))};var ButtonExpand=function(e){this.domNode=e,this.keyCode=Object.freeze(aria.KeyCode)};ButtonExpand.prototype.init=function(){this.controlledNode=!1;var e=this.domNode.getAttribute("aria-controls");e&&(this.controlledNode=document.getElementById(e)),this.domNode.setAttribute("aria-expanded","false"),this.hideContent(),this.domNode.addEventListener("keydown",this.handleKeydown.bind(this)),this.domNode.addEventListener("click",this.handleClick.bind(this)),this.domNode.addEventListener("focus",this.handleFocus.bind(this)),this.domNode.addEventListener("blur",this.handleBlur.bind(this))},ButtonExpand.prototype.showContent=function(){this.controlledNode&&(this.controlledNode.style.display="block")},ButtonExpand.prototype.hideContent=function(){this.controlledNode&&(this.controlledNode.style.display="none")},ButtonExpand.prototype.toggleExpand=function(){"true"===this.domNode.getAttribute("aria-expanded")?(this.domNode.setAttribute("aria-expanded","false"),this.hideContent()):(this.domNode.setAttribute("aria-expanded","true"),this.showContent())},ButtonExpand.prototype.handleKeydown=function(e){switch(e.keyCode){case this.keyCode.RETURN:this.toggleExpand(),e.stopPropagation(),e.preventDefault()}},ButtonExpand.prototype.handleClick=function(e){this.toggleExpand()},ButtonExpand.prototype.handleFocus=function(e){this.domNode.classList.add("focus")},ButtonExpand.prototype.handleBlur=function(e){this.domNode.classList.remove("focus")};var MenubarItem=function(e,t){this.menu=t,this.domNode=e,this.popupMenu=!1,this.hasFocus=!1,this.hasHover=!1,this.isMenubarItem=!0,this.keyCode=Object.freeze(aria.KeyCode)};MenubarItem.prototype.init=function(){this.domNode.tabIndex=-1,this.domNode.addEventListener("keydown",this.handleKeydown.bind(this)),this.domNode.addEventListener("focus",this.handleFocus.bind(this)),this.domNode.addEventListener("blur",this.handleBlur.bind(this)),this.domNode.addEventListener("click",this.handleClick.bind(this)),this.domNode.addEventListener("mouseover",this.handleMouseover.bind(this)),this.domNode.addEventListener("mouseout",this.handleMouseout.bind(this));var e=this.domNode.nextElementSibling;e&&"UL"===e.tagName&&(this.popupMenu=new PopupMenu(e,this),this.popupMenu.init())},MenubarItem.prototype.handleClick=function(e){},MenubarItem.prototype.handleKeydown=function(e){e.currentTarget;var t,i=e.key,s=!1;switch(e.keyCode){case this.keyCode.SPACE:case this.keyCode.RETURN:case this.keyCode.DOWN:this.popupMenu&&(this.popupMenu.open(),this.popupMenu.setFocusToFirstItem(),s=!0);break;case this.keyCode.LEFT:this.menu.setFocusToPreviousItem(this),s=!0;break;case this.keyCode.RIGHT:this.menu.setFocusToNextItem(this),s=!0;break;case this.keyCode.UP:this.popupMenu&&(this.popupMenu.open(),this.popupMenu.setFocusToLastItem(),s=!0);break;case this.keyCode.HOME:case this.keyCode.PAGEUP:this.menu.setFocusToFirstItem(),s=!0;break;case this.keyCode.END:case this.keyCode.PAGEDOWN:this.menu.setFocusToLastItem(),s=!0;break;case this.keyCode.TAB:this.popupMenu&&this.popupMenu.close(!0);break;default:1===(t=i).length&&t.match(/\S/)&&(this.menu.setFocusByFirstCharacter(this,i),s=!0)}s&&(e.stopPropagation(),e.preventDefault())},MenubarItem.prototype.setExpanded=function(e){e?this.domNode.setAttribute("aria-expanded","true"):this.domNode.setAttribute("aria-expanded","false")},MenubarItem.prototype.handleFocus=function(e){this.menu.hasFocus=!0},MenubarItem.prototype.handleBlur=function(e){this.menu.hasFocus=!1},MenubarItem.prototype.handleMouseover=function(e){this.hasHover=!0,this.popupMenu&&this.popupMenu.open()},MenubarItem.prototype.handleMouseout=function(e){this.hasHover=!1,this.popupMenu&&setTimeout(this.popupMenu.close.bind(this.popupMenu,!1),50)};var Menubar=function(t){var i="Menubar constructor argument menubarNode ";if(!t instanceof Element)throw new TypeError(i+"is not a DOM Element.");if(0===t.childElementCount)throw new Error(i+"has no element children.");for(e=t.firstElementChild;e;){var s=e.firstElementChild;if(e&&s&&"A"!==s.tagName)throw new Error(i+"has child elements are not A elements.");e=e.nextElementSibling}this.isMenubar=!0,this.domNode=t,this.menubarItems=[],this.firstChars=[],this.firstItem=null,this.lastItem=null,this.hasFocus=!1,this.hasHover=!1};Menubar.prototype.init=function(){var e,t,i;for(elem=this.domNode.firstElementChild;elem;){var s=elem.firstElementChild;elem&&s&&"A"===s.tagName&&((e=new MenubarItem(s,this)).init(),this.menubarItems.push(e),t=s.textContent.trim(),this.firstChars.push(t.substring(0,1).toLowerCase())),elem=elem.nextElementSibling}0<(i=this.menubarItems.length)&&(this.firstItem=this.menubarItems[0],this.lastItem=this.menubarItems[i-1]),this.firstItem.domNode.tabIndex=0},Menubar.prototype.setFocusToItem=function(e){for(var t=!1,i=0;i<this.menubarItems.length;i++){var s=this.menubarItems[i];0==s.domNode.tabIndex&&(t="true"===s.domNode.getAttribute("aria-expanded")),s.domNode.tabIndex=-1,s.popupMenu&&s.popupMenu.close()}e.domNode.focus(),e.domNode.tabIndex=0,t&&e.popupMenu&&e.popupMenu.open()},Menubar.prototype.setFocusToFirstItem=function(e){this.setFocusToItem(this.firstItem)},Menubar.prototype.setFocusToLastItem=function(e){this.setFocusToItem(this.lastItem)},Menubar.prototype.setFocusToPreviousItem=function(e){var t;if(e===this.firstItem)newItem=this.lastItem;else{for(t=this.menubarItems.indexOf(e);0<=--t&&(newItem=this.menubarItems[t],!(0<newItem.domNode.offsetWidth)););0===newItem.domNode.offsetWidth&&(newItem=this.lastItem)}this.setFocusToItem(newItem)},Menubar.prototype.setFocusToNextItem=function(e){var t;if(e===this.lastItem)newItem=this.firstItem;else{for(t=this.menubarItems.indexOf(e);++t<this.menubarItems.length&&(newItem=this.menubarItems[t],!(0<newItem.domNode.offsetWidth)););0===newItem.domNode.offsetWidth&&(newItem=this.firstItem)}this.setFocusToItem(newItem)},Menubar.prototype.setFocusByFirstCharacter=function(e,t){var i,s;t=t.toLowerCase(),e.domNode.getAttribute("aria-expanded");(i=this.menubarItems.indexOf(e)+1)===this.menubarItems.length&&(i=0),-1===(s=this.getIndexFirstChars(i,t))&&(s=this.getIndexFirstChars(0,t)),-1<s&&this.setFocusToItem(this.menubarItems[s])},Menubar.prototype.getIndexFirstChars=function(e,t){for(var i=e;i<this.firstChars.length;i++)if(t===this.firstChars[i])return i;return-1};var MenuItem=function(e,t){"object"!=typeof popupObj&&(popupObj=!1),this.domNode=e,this.menu=t,this.popupMenu=!1,this.isMenubarItem=!1,this.keyCode=Object.freeze(aria.KeyCode)};MenuItem.prototype.init=function(){this.domNode.tabIndex=-1,this.domNode.addEventListener("keydown",this.handleKeydown.bind(this)),this.domNode.addEventListener("click",this.handleClick.bind(this)),this.domNode.addEventListener("focus",this.handleFocus.bind(this)),this.domNode.addEventListener("blur",this.handleBlur.bind(this)),this.domNode.addEventListener("mouseover",this.handleMouseover.bind(this)),this.domNode.addEventListener("mouseout",this.handleMouseout.bind(this));var e=this.domNode.nextElementSibling;e&&"UL"===e.tagName&&(this.popupMenu=new PopupMenu(e,this),this.popupMenu.init())},MenuItem.prototype.isExpanded=function(){return"true"===this.domNode.getAttribute("aria-expanded")},MenuItem.prototype.handleKeydown=function(e){var t,i,s=e.currentTarget,o=e.key,r=!1;switch(e.keyCode){case this.keyCode.SPACE:case this.keyCode.RETURN:if(this.popupMenu)this.popupMenu.open(),this.popupMenu.setFocusToFirstItem();else{try{t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})}catch(e){document.createEvent&&(t=document.createEvent("MouseEvents")).initEvent("click",!0,!0)}s.dispatchEvent(t)}r=!0;break;case this.keyCode.UP:this.menu.setFocusToPreviousItem(this),r=!0;break;case this.keyCode.DOWN:this.menu.setFocusToNextItem(this),r=!0;break;case this.keyCode.LEFT:this.menu.setFocusToController("previous",!0),this.menu.close(!0),r=!0;break;case this.keyCode.RIGHT:this.popupMenu?(this.popupMenu.open(),this.popupMenu.setFocusToFirstItem()):(this.menu.setFocusToController("next",!0),this.menu.close(!0)),r=!0;break;case this.keyCode.HOME:case this.keyCode.PAGEUP:this.menu.setFocusToFirstItem(),r=!0;break;case this.keyCode.END:case this.keyCode.PAGEDOWN:this.menu.setFocusToLastItem(),r=!0;break;case this.keyCode.ESC:this.menu.setFocusToController(),this.menu.close(!0),r=!0;break;case this.keyCode.TAB:this.menu.setFocusToController();break;default:1===(i=o).length&&i.match(/\S/)&&(this.menu.setFocusByFirstCharacter(this,o),r=!0)}r&&(e.stopPropagation(),e.preventDefault())},MenuItem.prototype.setExpanded=function(e){e?this.domNode.setAttribute("aria-expanded","true"):this.domNode.setAttribute("aria-expanded","false")},MenuItem.prototype.handleClick=function(e){this.menu.setFocusToController(),this.menu.close(!0)},MenuItem.prototype.handleFocus=function(e){this.menu.hasFocus=!0},MenuItem.prototype.handleBlur=function(e){this.menu.hasFocus=!1,setTimeout(this.menu.close.bind(this.menu,!1),50)},MenuItem.prototype.handleMouseover=function(e){this.menu.hasHover=!0,this.menu.open(),this.popupMenu&&(this.popupMenu.hasHover=!0,this.popupMenu.open())},MenuItem.prototype.handleMouseout=function(e){this.popupMenu&&(this.popupMenu.hasHover=!1,this.popupMenu.close(!0)),this.menu.hasHover=!1,setTimeout(this.menu.close.bind(this.menu,!1),300)};var PopupMenu=function(e,t){var i="PopupMenu constructor argument domNode ";if(!e instanceof Element)throw new TypeError(i+"is not a DOM Element.");if(0===e.childElementCount)throw new Error(i+"has no element children.");for(var s=e.firstElementChild;s;){var o=s.firstElementChild;if(o&&"A"===o)throw new Error(i+"has descendant elements that are not A elements.");s=s.nextElementSibling}this.isMenubar=!1,this.domNode=e,this.controller=t,this.menuitems=[],this.firstChars=[],this.firstItem=null,this.lastItem=null,this.hasFocus=!1,this.hasHover=!1};PopupMenu.prototype.init=function(){var e,t,i,s,o;for(e=this.domNode.firstElementChild;e;)(t=e.firstElementChild)&&"A"===t.tagName&&((i=new MenuItem(t,this)).init(),this.menuitems.push(i),s=t.textContent.trim(),this.firstChars.push(s.substring(0,1).toLowerCase())),e=e.nextElementSibling;0<(o=this.menuitems.length)&&(this.firstItem=this.menuitems[0],this.lastItem=this.menuitems[o-1])},PopupMenu.prototype.handleMouseover=function(e){this.hasHover=!0},PopupMenu.prototype.handleMouseout=function(e){this.hasHover=!1,setTimeout(this.close.bind(this,!1),1)},PopupMenu.prototype.setFocusToController=function(e,t){function i(e,t){for(;e;){if(e.isMenubarItem)return e.domNode.focus(),e;t&&e.menu.close(!0),e.hasFocus=!1,e=e.menu.controller}return!1}if("string"!=typeof e&&(e=""),""!==e){if(this.controller.isMenubarItem)"previous"===e?this.controller.menu.setFocusToPreviousItem(this.controller,t):"next"===e&&this.controller.menu.setFocusToNextItem(this.controller,t);else if(this.controller.domNode.focus(),this.close(),"next"===e){var s=i(this.controller,!1);s&&s.menu.setFocusToNextItem(s,t)}}else i(this.controller,!0)},PopupMenu.prototype.setFocusToFirstItem=function(){if(0<this.firstItem.domNode.offsetWidth)this.firstItem.domNode.focus();else{for(var e=1;0===this.menuitems[e].domNode.offsetWidth;)e++;this.menuitems[e].domNode.focus()}},PopupMenu.prototype.setFocusToLastItem=function(){if(0<this.lastItem.domNode.offsetWidth)this.lastItem.domNode.focus();else{for(var e=this.menuitems.indexOf(this.lastItem.domNode)-1;0<=e&&0===this.menuItems[e].domNode.offsetWidth;)e--;this.menuitems[e].domNode.focus()}},PopupMenu.prototype.setFocusToPreviousItem=function(e){var t;e===this.firstItem?this.lastItem.domNode.focus():(t=this.menuitems.indexOf(e),this.menuitems[t-1].domNode.focus())},PopupMenu.prototype.setFocusToNextItem=function(e){var t;e===this.lastItem?this.firstItem.domNode.focus():(t=this.menuitems.indexOf(e),this.menuitems[t+1].domNode.focus())},PopupMenu.prototype.setFocusByFirstCharacter=function(e,t){var i,s;t=t.toLowerCase();(i=this.menuitems.indexOf(e)+1)===this.menuitems.length&&(i=0),-1===(s=this.getIndexFirstChars(i,t))&&(s=this.getIndexFirstChars(0,t)),-1<s&&this.menuitems[s].domNode.focus()},PopupMenu.prototype.getIndexFirstChars=function(e,t){for(var i=e;i<this.firstChars.length;i++)if(t===this.firstChars[i])return i;return-1},PopupMenu.prototype.open=function(){var e=this.controller.domNode.getBoundingClientRect();this.controller.setExpanded(!0),this.controller.isMenubarItem?(this.domNode.style.display="block",this.domNode.style.position="absolute"):(this.domNode.parentNode.style.position="relative",this.domNode.style.display="block",this.domNode.style.position="absolute",this.domNode.style.left=e.width+"px"),this.domNode.style.zIndex=100},PopupMenu.prototype.close=function(e){for(var t=this.controller.hasHover,i=this.hasFocus,s=0;s<this.menuitems.length;s++){var o=this.menuitems[s];o.popupMenu&&(i|=o.popupMenu.hasFocus)}this.controller.isMenubarItem||(t=!1),!e&&(i||this.hasHover||t)||(this.domNode.style.display="none",this.domNode.style.zIndex=0,this.controller.setExpanded(!1))};
